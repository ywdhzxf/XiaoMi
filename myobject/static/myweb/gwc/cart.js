!function(t){function e(i){if(a[i])return a[i].exports;var o=a[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){a(2),a(3),MI.cart=function(){function t(){$.ajax({url:j.urls.getList,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,error:function(){L.tipMsg("网络出错，请刷新页面！")},success:function(t){t&&1===t.code?(j.listData=t.data,e(t.data),a(),j.selGoodsTotal=0,j.goodsTotal=0,j.giftTotal=0,$("#J_cartLoading").addClass("hide")):(t.code>1e3||t.code<0)&&L.tipMsg(t.msg)}})}function e(){if($(".J_goShoping").attr("href",MI.GLOBAL_CONFIG.listSite+"/0"),j.listData.items.length<=0)return $("#J_cartEmpty").removeClass("hide"),$("#J_cartBox").addClass("hide"),$("#J_miniHeaderTitle").html("<h2>我的购物车</h2>").removeClass("has-more"),$.cookie("cUserId")||$.cookie("userId")||($("#J_cartEmpty").addClass("cart-empty-nologin"),$("#J_loginBtn").attr("href",MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href)),void w(!0);location.href.indexOf("autogo")>=0&&$("#J_goCheckout").trigger("click"),$("#J_cartBox").removeClass("hide"),$.each(j.listData.items,function(t,e){e.isOvercartTTL||e.showCos||!e.is_on_sale?(1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(j.goodsTotal+=parseInt(e.num)):(j.goodsTotal+=parseInt(e.num),e.pulse_bargains_cart&&e.pulse_bargains_cart.length&&$.each(e.pulse_bargains_cart,function(t,e){j.goodsTotal+=parseInt(e.num)}),e.pulse_gift&&e.pulse_gift.length&&$.each(e.pulse_gift,function(t,e){j.goodsTotal+=parseInt(e.num)})),e.properties&&e.properties.insurance&&e.properties.insurance.itemId&&(j.goodsTotal+=parseInt(e.num))}),j.listData.activitys.gift&&j.listData.activitys.gift.length&&$.each(j.listData.activitys.gift,function(t,e){j.giftTotal+=parseInt(e.num)});var t="";j.listData.shipmentDes?(t="<p>"+j.listData.shipmentDesc+"</p>",$("#J_miniHeaderTitle").addClass("has-more")):($("#J_miniHeaderTitle").addClass("has-more"),t="<p>温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</p>"),$("#J_miniHeaderTitle").html("<h2>我的购物车</h2>"+t),$("#J_cartTotalNum").text(j.goodsTotal+j.giftTotal).parent().removeClass("hide"),j.listData.activityDiscountMoney>0?$("#J_cartActivityMoney").text(j.listData.activityDiscountMoney).parent().removeClass("hide"):$("#J_cartActivityMoney").text("0").parent().addClass("hide"),$("#J_cartTotalPrice").text(j.listData.orderMoneySelGoods),!j.listData.postFree&&j.listData.postFreeBalance?($("#J_postFreeBalance").text(j.listData.postFreeBalance),j.listData.gatherorder_goods_list&&j.listData.gatherorder_goods_list.length>0&&($("#J_coudanTip").removeClass("hide"),$("#J_showCoudan").removeClass("hide"))):$("#J_coudanTip").addClass("hide")}function a(){j.listData.items.length<=0||(i(j.listData.items),o(j.listData.activitys),j.listData.giftsDiv&&j.listData.giftsDiv.length&&r(j.listData.giftsDiv),s(j.listData.bargains),j.listData.bargainDiv&&j.listData.bargainDiv.length&&n(j.listData.bargainDiv),j.listData.gatherorder_goods_list&&j.listData.gatherorder_goods_list.length&&c(j.listData.gatherorder_goods_list),j.closeGoods=[],$.each(j.listData.items,function(t,e){(e.isOvercartTTL||e.showCos||!e.is_on_sale)&&j.closeGoods.push(e)}),j.closeGoods.length&&d(),l(j.listData.items),p())}function i(t){var e=doT.template($("#J_cartGoodsTemplate").html()),a=e(t);$("#J_cartListBody").html(a)}function o(t){if(t){var e=doT.template($("#J_cartActivitysTemplate").html()),a=e(t);$("#J_cartListBody").append(a)}}function s(t){if(t){var e=doT.template($("#J_cartRaisebuyTemplate").html()),a=e(t);$(".J_modalRaiseBuy").remove(),$("#J_raiseBuyBox").html(a)}}function n(t){if(t){$(".J_cartGoods").each(function(){var e=L.parseJson($(this).attr("data-info"));return"bargain"!==e.gettype?!0:void $.each(t,function(t,a){return e.itemid.indexOf(a.actId)<0?!0:void $.each(a.selecInfo,function(t,a){return e.itemid.indexOf(a.product_id)<0?!0:(a.num=e.num,void(a.isBuy="true"))})})});var e=doT.template($("#J_cartRaisebuyClassTemplate").html()),a=e(t);$(".J_modalRaisebuy").remove(),$("body").append(a)}}function r(t){if(t){var e=doT.template($("#J_cartGiftTemplate").html()),a=e(t);$(".J_modalGift").remove(),$("body").append(a)}}function c(t){if(t){var e=doT.template($("#J_cartCoudanTemplate").html()),a=e(t);$(".J_modalCoudan").remove(),$("body").append(a),$("#J_coudanMoney").text(j.listData.postFreeBalance)}}function d(){var t=doT.template($("#J_cartCloseTemplate").html()),e=t(j.closeGoods),a='<div class="item-disable-box">'+e+"</div>";$("#J_cartListBody").append(a)}function l(t){$.each(t,function(t,e){e.isOvercartTTL||e.showCos||!e.is_on_sale?(1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(j.selGoodsTotal+=parseInt(e.num)):((1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(j.selGoodsTotal+=1*e.num,e.properties&&e.properties.insurance&&e.properties.insurance.itemId&&(j.selGoodsTotal+=parseInt(e.num)),e.pulse_bargains_cart&&e.pulse_bargains_cart.length&&$.each(e.pulse_bargains_cart,function(t,e){j.selGoodsTotal+=parseInt(e.num)}),e.pulse_gift&&e.pulse_gift.length&&$.each(e.pulse_gift,function(t,e){j.selGoodsTotal+=e.num})),e.pulse_bargains&&$.each(e.pulse_bargains,function(t,e){e.selectable&&u(e)}),e.pulse_gift&&$.each(e.pulse_gift,function(t,e){e.selectable&&m(e)}))}),j.selGoodsTotal===j.goodsTotal&&j.selGoodsTotal>0?$("#J_selectAll").addClass("icon-checkbox-selected"):$("#J_selectAll").removeClass("icon-checkbox-selected"),j.selGoodsTotal<=0?($("#J_goCheckout").removeClass("btn-primary").addClass("btn-disabled"),$("#J_noSelectTip").removeClass("hide")):($("#J_goCheckout").removeClass("btn-disabled").addClass("btn-primary"),$("#J_noSelectTip").addClass("hide")),$("#J_selTotalNum").html(j.selGoodsTotal+j.giftTotal)}function u(t){if(t){var e=[];e.push(t);var a=doT.template($("#J_goodsSubRaisebuyClassTemplate").html()),i=a(e);$("#J_choosePro-"+t.actId).remove(),$("body").append(i)}}function m(t){if(t){var e=[];e.push(t);var a=doT.template($("#J_cartGiftTemplate").html()),i=a(e);$("body").append(i)}}function p(){h(),_(!0),w()}function h(){$(".J_delGoods").off().on("click",function(){return b($(this)),!1}),$(".J_changeGoodsNum").on("mouseover",function(){$(this).toggleClass("change-goods-num-hover")}).on("mouseout",function(){$(this).toggleClass("change-goods-num-hover")}),$(".J_goodsNum").off().on("blur",function(){var t=parseInt($(this).val()),e=parseInt($(this).attr("data-buylimit")),a=parseInt($(this).attr("data-num")),i=$(this).attr("name"),o=$.isNumeric(t);if(o){if(1>t)return $(this).val(a),!1;if(t>e)return v(e,"input",i),L.tipMsg("该商品数量不能大于"+e),!1;v(t,"input",i)}else L.tipMsg("输入的数量只能是数字！"),$(this).val(a)}),$(".J_minus").off().on("click",function(){var t=$(this).parent().find(".J_goodsNum"),e=parseInt(t.val());return $.isNumeric(e)?e>1&&v(e,"reduce",t.attr("name")):L.tipMsg("输入的数量只能是数字！"),!1}),$(".J_plus").off().on("click",function(){var t=$(this).parent().find(".J_goodsNum"),e=parseInt(t.val()),a=parseInt(t.attr("data-buylimit")),i=t.attr("name");return $.isNumeric(e)?(e>=1&&a>e?v(e,"add",i):v(a,"add",i),!1):(L.tipMsg("输入的数量只能是数字!"),!1)}),J(),$(".J_chooseGift").on("click",function(){var t=$(this).attr("data-actId");return y("#J_choosePro-"+t),!1}),T(),M(),G(),$("#J_showCoudan").off().on("click",function(){return y("#J_CoudanBox"),!1}),$(".J_carouselList").carousel({itemPerSlide:5,containerSelector:".J_carouselContainer",controlsSelector:".J_carouselControl",controls:!1,pager:!0}),$(".J_addFavorite").on("click",function(){var t=$(this).attr("data-gid");return t?void $.ajax({url:j.urls.favorite+t,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,error:function(){},success:function(e){e&&1===e.code?$('.J_addFavorite[data-gid="'+t+'"]').addClass("is-favorite"):L.tipMsg(e.msg)}}):!1}),$(".J_itemCheckbox").on("click",function(){var t=$(this).hasClass("icon-checkbox-selected"),e=$(this).attr("data-itemid");t?f(e,0):f(e,1)})}function f(t,e,a){$.ajax({url:j.urls.sel,dataType:"jsonp",data:{itemId:t,status:e},jsonp:"jsonpcallback",success:function(t){1===t.code?(I(),"function"==typeof a&&a()):L.tipMsg(t.msg)}})}function g(){$("#J_selectAll").on("click",function(){var t=$(this).hasClass("icon-checkbox-selected"),e=[],a=null;$(".J_itemCheckbox").each(function(){e.push($(this).attr("data-itemid")),a=t?0:1}),e.length&&f(e.join("__"),a)})}function _(t){var e=$("#J_cartBar"),a=$(window).height(),i="cart-bar-fixed";t&&e.removeClass(i);var o=e.offset();o.top>a?e.addClass(i):e.removeClass(i);var s=0;$(window).off("scroll").on("scroll",function(){s=$(this).scrollTop()+a,s>o.top?e.removeClass(i):e.addClass(i)})}function v(t,e,a){"add"===e?t+=1:"reduce"===e&&(t-=1),$.ajax({url:MI.GLOBAL_CONFIG.cartSite+"/cart/update?api=1&Cart="+a+"__"+t,dataType:"jsonp",jsonp:"jsonpcallback",success:function(t){var e=$.trim(t.msg);if("ok"===e)MI.updateMiniCart();else{if("CANTMODIFY"===e)return L.tipMsg("非常抱歉！该商品不允许修改数量！"),!1;if("SALEOUT"===e)return L.tipMsg("修改失败！"),window.location.reload(),!1;if(e.indexOf("MAX")>-1){var a=e.split("|");return $("#J_cart_"+a[1]).val(a[2]),L.tipMsg("1"===a[3]?"每笔订单最多购买4部小米手机。如有需要，请您另下订单继续购买。":"超出商品最大购买数量。"),!1}L.tipMsg(e)}I()}})}function b(t){if(t.length){var e=t.attr("data-msg"),a=t.attr("id");L.tipMsg(e,!0,function(){C(a)})}}function C(t){t&&$.ajax({dataType:"jsonp",url:MI.GLOBAL_CONFIG.cartSite+"/cart/delete/"+t+"?api=1&ajax=cart-grid",jsonp:"jsonpcallback",cache:"false",success:function(t){1===t.code?I():L.tipMsg(t.msg)}})}function J(){$(".J_raiseBuyItem").on("click",function(){var t=L.parseJson($(this).attr("data-info")),e=$(this).hasClass("selected");if(e)C(t.bargainid);else if("true"===t.isBatch)y("#J_choosePro-"+t.actId);else{if(t.num&&t.num>0){var a=t.maxnum-t.num+1;t.goodsId=t.productId+"-0-"+a+"-"+t.actId}k(t.goodsId,t.actId,t.type)}})}function y(t){if(t&&$(t).length){var e=$(t),a=e.find(".J_chooseProList"),i=e.find(".J_chooseProBtn"),o=e.attr("data-isadd")||!1,s=e.attr("data-isgift")||!1,n=a.find("li").length;e.addClass("modal-choose-pro-"+n),e.on("shown.bs.modal",function(){$(".modal-backdrop").addClass("modal-backdrop-dark")}).on("show.bs.modal",function(){$(this).find(".list").find("img").each(function(){$(this).attr("data-src")&&$(this).attr("src",$(this).attr("data-src"))})}).modal({backdrop:"static",show:!0}),a.children("li").on("click",function(){$(this).addClass("selected").siblings().removeClass("selected");var t=$(this).attr("data-gid"),e=$(this).attr("data-price"),a=$(this).attr("data-coudan"),o=$(this).attr("data-num"),s=$(this).attr("data-maxnum");if("true"===a){var n=j.listData.postFreeBalance-parseFloat(e);n>0?($("#J_coudanOver").addClass("hide"),$("#J_coudanDesc").removeClass("hide")):($("#J_coudanOver").removeClass("hide"),$("#J_coudanDesc").addClass("hide"))}if(o&&s){o=parseInt(o),s=parseInt(s);var r=$(this).attr("data-pid"),c=$(this).attr("data-actid");if(s>o){var d=[];$(this).siblings("li").each(function(){var t=parseInt($(this).attr("data-num"));t>0&&d.push($(this).attr("data-pid")+"-0-"+t+"-"+$(this).attr("data-actid"))}),o+=1,t=d.length?r+"-0-"+o+"-"+c+"_"+d.join("_"):r+"-0-"+o+"-"+c,$(this).attr("data-gid",t)}}i.attr("href","/cart/add/"+t).removeClass("btn-disable").addClass("btn-primary")}),i.off().on("click",function(){if($(this).hasClass("btn-disable"))return!1;var t=a.find(".selected").attr("data-gid");if("true"===o&&a.find('[data-isbuy="true"]').length>0){t="";var i=!0,n=0;a.find('[data-isbuy="true"]').each(function(){var e=$(this).attr("data-pid"),a=$(this).attr("data-num"),o=$(this).attr("data-actid");$(this).hasClass("selected")&&(a=parseInt(a)+1,i=!1),t+=(n>0?"_":"")+e+"-0-"+a+"-"+o,n+=1}),i&&(t+="_"+a.find(".selected").attr("data-gid"))}if("true"===o||"true"===s){var r=$(this).attr("data-actid"),c=$(this).attr("data-type");k(t,r,c)}else x(t);return e.modal("hide"),!1})}}function x(t){MI.addShopCart(t,function(t){t&&1===t.code?I():L.tipMsg(t.msg)})}function k(t,e,a){var i=MI.GLOBAL_CONFIG.cartSite+"/cart/addCartActivity.php";$.ajax({url:i,dataType:"jsonp",data:"id="+t+"&promotion_id="+e+"&promotion_type="+a+"&api=1",jsonp:"jsonpcallback",timeout:1e4,error:function(){L.tipMsg("网络请求超时")},success:function(t){1===t.code?I():L.tipMsg(t.message)}})}function I(){t()}function T(){var t="";$(".J_showBaoxian").off().on("click",function(){var e=L.parseJson($(this).attr("data-info"));t=e.goodsId+"?parent_itemId="+e.parent_itemId,$(".J_buyBaoxian").find(".num").html(e.count+"份"),$("#J_baoxian").modal({backdrop:"static",show:!0});var a=MI.GLOBAL_CONFIG.cartSite+"/static/insuranceAgreement.php?type="+e.type;$(".J_baoxianMore").attr("href",a)}),$(".J_baoxianAgree").off().on("click",function(){$(this).toggleClass("selected")}),$(".J_buyBaoxian").off().on("click",function(){var e=$(".J_baoxianAgree").hasClass("selected");e?(x(t),$("#J_baoxian").modal("hide")):alert("请先阅读并同意《小米手机意外保障服务》！")}),$("#J_baoxian").on("hide.bs.modal",function(){$(".J_baoxianAgree").removeClass("selected")})}function M(){$(".J_showGuajia").on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");$(".J_buyGuaJia").attr("data-gid",t).attr("data-parent_itemid",e),$("#J_modalGuajia").modal({backdrop:"static",show:!0})}),$(".J_buyGuaJia").off().on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");t&&e?(t+="?parent_itemId="+e,x(t),$("#J_modalGuajia").modal("hide")):alert("参数错误")})}function G(){$(".J_showWaterInstall").on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");$(".J_buyWaterInstall").attr("data-gid",t).attr("data-parent_itemid",e),$("#J_modalWaterInstall").modal({backdrop:"static",show:!0})}),$(".J_buyWaterInstall").off().on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");t&&e?(t+="?parent_itemId="+e,x(t),$("#J_modalWaterInstall").modal("hide")):alert("参数错误")})}function w(t){if(t)$("#J_miRecommendBox").addClass("hide"),$("#J_historyRecommend").removeClass("hide").miRecommend({type:"historyRecommend"});else{var e=[];$(".J_cartGoods").each(function(){var t=L.parseJson($(this).attr("data-info"));t&&e.push(t.commodity_id)}),$("#J_miRecommendBox").removeClass("hide").miRecommend({type:"recommendBox",gid:e?e.join():""})}}function S(){$("#J_goCheckout").on("click",function(){var t=$(this).hasClass("btn-disabled");return t?!1:($(this).addClass("btn-disabled"),void $.ajax({url:j.urls.preCheckout+"?r="+L.randomNum(),dataType:"jsonp",jsonp:"jsonpcallback",timeout:5e3,error:function(){$(this).removeClass("btn-disabled"),location.href=MI.GLOBAL_CONFIG.orderSite+"/buy/checkout?r="+L.randomNum()},success:function(t){if($(this).removeClass("btn-disabled"),1===t.code)location.href=MI.GLOBAL_CONFIG.orderSite+"/buy/checkout?r="+L.randomNum();else if(-2===t.code)location.href=MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href+"?autogo";else if(2004002===t.code)location.reload();else if(10006===t.code)L.tipMsg(t.msg);else{var e=!1;$.each(j.preCheckoutCode,function(a,i){return t.code.toString()===a?(t.texts=i,e=!0,!1):void 0}),e?D(t):L.tipMsg(t.msg)}}}))})}function D(t){if(t){$("#J_modalPrecheckTip").remove();var e=doT.template($("#J_preCheckTipTemplate").html()),a=e(t);$("body").append(a),t.data.items&&t.data.items.length>3&&$("#J_preCheckList").carousel({itemPerSlide:3,containerSelector:"#J_modalPrecheckTip",controlsSelector:".modal-bd",controls:!0,pager:!1}),$("#J_modalPrecheckTip").modal({backdrop:"static",show:!0}).on("hide.be.modal",function(){$("#J_goCheckout").removeClass("btn-disabled")}),B()}}function B(){$("#J_preCheckBtn").on("click",function(){var t=$(this).attr("data-action");if(t){if("3"===t)return $("#J_modalPrecheckTip").modal("hide"),void I();var e=$("#J_preCheckList").find("li"),a=[],i=[],o=[];$(".J_itemCheckbox").each(function(){var t=$(this).attr("data-itemid"),e=$(this).hasClass("icon-checkbox-selected"),a=$(this).attr("data-isdis");i.push(t),e&&"true"===a&&o.push(t)}),e.each(function(){var t=$(this).attr("data-itemid");a.push(t)}),"1"===t?f(i.join("__"),0,function(){f(a.join("__"),1,function(){$("#J_modalPrecheckTip").modal("hide"),$("#J_goCheckout").trigger("click")})}):"2"===t?f(a.join("__"),0,function(){$("#J_modalPrecheckTip").modal("hide"),$("#J_goCheckout").trigger("click")}):"4"===t&&o.length&&f(o.join("__"),0,function(){$("#J_modalPrecheckTip").modal("hide")})}})}var j={urls:{getList:MI.GLOBAL_CONFIG.cartSite+"/cart/getList.php?api=1",favorite:MI.GLOBAL_CONFIG.orderSite+"/favorite/add/id/",sel:MI.GLOBAL_CONFIG.cartSite+"/cart/sel.php",preCheckout:MI.GLOBAL_CONFIG.orderSite+"/buy/checkoutPreCheck.php"},listData:null,selGoodsTotal:0,goodsTotal:0,giftTotal:0,preCheckoutCode:{2003073:{title:"以下为预售商品，需要单独结算",btn:"先购买这些商品",action:1},2003072:{title:"以下为开放购买商品，需要单独结算",btn:"先购买这些商品",action:1},2003074:{title:"以下为大型商品（需特殊配送），需要单独结算",btn:"先购买这些商品",action:1},2003075:{title:"以下为合约机，需要单独结算",btn:"先购买这些商品",action:1},2003080:{title:"以下为需要特殊配送的商品，需要单独结算",btn:"先购买这些商品",action:1},2003077:{title:"抱歉，以下商品已经失效或者暂时售罄",btn:"购买其他已选商品",action:2},2003076:{msg:"抱歉，已选商品已经失效或者暂时售罄",btn:"看看其他商品",action:4},2004046:{msg:"抱歉，已选商品已经下架",btn:"看看其他商品",action:4},2003078:{msg:"请勾选需要结算的商品",btn:"确定",action:3}}},L={tipMsg:function(t,e,a){if(t){var i="";t.length>10&&(i="much-text"),$("#J_alertMsg").html(t).addClass(i),$("#J_modalAlert").modal("show").on("hide.bs.modal",function(){$("#J_alertMsg").html(""),$("#J_alertOk").off()}),e?$("#J_alertCancel").removeClass("hide"):$("#J_alertCancel").addClass("hide"),"function"==typeof a&&$("#J_alertOk").off().on("click",a)}else $("#J_modalAlert").modal("hide")},randomNum:function(){return parseInt(9e4*Math.random()+1e4)+"."+parseInt((new Date).getTime()/1e3)},formatImageUrl:function(t,e){if(t&&e){var a=t.lastIndexOf("."),i=t.slice(a),o=t.slice(0,a),s=o+"!"+e+"x"+e+i;return s}},formatDate:function(t,e){if(t){var a=new Date(1e3*parseInt(t)),i={Y:a.getFullYear(),M:a.getMonth()+1,D:a.getDate(),h:a.getHours()<10?"0"+a.getHours():a.getHours(),m:a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),s:a.getSeconds()},o=e||"##Y##-##M##-##D## ##h##:##m##:##s##",s="";for(var n in i)i[n]>=0&&(s="##"+n+"##",o.indexOf(s)>=0&&(o=o.replace(s,i[n])));return o}},parseJson:function(t){return new Function("return "+t)()}},O=function(){t(),g(),S(),$(window).on("resize",function(){_(!0)})};return{init:O,unit:L}}(),$(document).ready(function(){MI.cart.init()})},function(t,e){!function(t){function e(e){function a(){return 0>=$?!1:(b&&clearInterval(b),void(b=setTimeout(function(){var t=C===$-1?0:C+1;i(t),a()},h.pause)))}function i(t){return C===t?!1:(v.css({marginLeft:-g*f*t,transition:"margin-left "+h.speed/1e3+"s "+h.easing}),h.controls&&(0===t?l.addClass("control-disabled"):l.removeClass("control-disabled"),t===$-1?u.addClass("control-disabled"):u.removeClass("control-disabled")),h.pager&&m.find("li").eq(t).addClass("pager-active").siblings().removeClass("pager-active"),void(C=t))}function o(){for(var e='<ul class="xm-pagers">',a=0,o=$;o>a;a+=1)e+='<li class="pager'+(0===a?" pager-active":"")+'"><span class="dot">'+(a+1)+"</span></li>";e+="</ul>",m.html(e),m.find("li").off(".carousel").on("click.carousel",function(){t(this).addClass("pager-active").siblings().removeClass("pager-active"),i(m.find("li").index(t(this)))})}function s(){f=h.itemPerSlide||Math.ceil(r.width()/g),$=Math.ceil(c.length/f),1>=$||(i(0),h.pager&&o(),h.auto&&(a(),h.controls&&d.find(".control").off(".carousel").on({"mouseenter.carousel":function(){b&&clearTimeout(b)},"mouseleave.carousel":function(){a()}}),h.pager&&m.find(".pager").off(".carousel").on({"mouseenter.carousel":function(){b&&clearTimeout(b)},"mouseleave.carousel":function(){a()}})))}var n,r,c,d,l,u,m,p,h,f,g,_,$,v=t(this),b=0,C=-1;return p={itemSelector:"> li",itemWidth:null,itemHeight:null,itemPerSlide:null,containerSelector:null,controlsSelector:null,pagersSelector:null,speed:500,easing:"ease",auto:!1,pause:5e3,controls:!0,controlsClass:"xm-controls-line-small",pager:!1,onLoad:t.noop},h=t.extend({},p,e),c=v.find(h.itemSelector),h.itemPerSlide&&c.length<=h.itemPerSlide?this:(g=h.itemWidth||c.outerWidth(!0),_=h.itemHeight||c.outerHeight(),n=h.containerSelector?v.closest(h.containerSelector):v.parent(),n.addClass("xm-carousel-container"),r=v.wrap('<div class="xm-carousel-wrapper"></div>').closest(".xm-carousel-wrapper").css({height:_,overflow:"hidden"}),v.css("width",g*c.length),h.controls&&(d=t('<div class="xm-controls '+h.controlsClass+' xm-carousel-controls"><a class="control control-prev iconfont" href="javascript: void(0);">&#xe628;</a><a class="control control-next iconfont" href="javascript: void(0);">&#xe623;</a></div>'),h.controlsSelector?n.find(h.controlsSelector).append(d):d.insertAfter(r),l=d.find(".control-prev"),u=d.find(".control-next"),l.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(C-1)}),u.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(C+1)})),h.pager&&(m=t('<div class="xm-pagers-wrapper"></div>'),h.pagersSelector?n.find(h.pagersSelector).append(m):m.insertAfter(r)),s(),h.onLoad(v),void t(window).on("resize",s))}t.fn.carousel=function(t){return this.each(function(){e.call(this,t)}),this}}(jQuery)},function(t,e,a){function i(t,e,a){var i=t.find("a");$.each(i,function(t,i){var o,s=$(i).attr("data-stat-index"),r=n($(i).attr("data-stat-text")),c=$(i).attr("data-stat-method"),d=$(i).attr("data-stat-addcart");o=d?"stat_"+e+d+"."+a+"_"+s+"_"+c:"stat_"+e+"."+a+"_"+s+"_"+c,$(i).attr({"data-stat-pid":o,"data-stat-aid":r})})}function o(t,e){"cart"!==s.page[s.type]&&s.useCarousel[s.type]&&e.carousel({containerSelector:t,controls:!0,pager:!0,itemHeight:320}),s.isBuy[s.type]&&($(".J_xm-recommend-list").hover(function(){$(this).find(".J_xm-recommend-btn").show()},function(){$(this).find(".J_xm-recommend-btn").hide()}),$(".J_xm-recommend-btn").off(".addcart").on("click.addcart",function(){function t(){a.removeClass("xm-recommend-notice-active"),setTimeout(function(){e.removeClass("disabled"),a.empty()},500)}var e=$(this),a=e.parent().siblings(".xm-recommend-notice");return e.hasClass("disabled")?!1:(MI.addShopCart(e.attr("data-stat-gid"),function(e){1===e.code?"cart"!==s.page[s.type]?(a.addClass("xm-recommend-notice-active").empty().append('<a class="btn btn-block btn-green btn-notice" href="javascript: void(0);">成功加入购物车</a>'),a.find(".btn-notice").one("click",t),setTimeout(function(){t(),location.reload()},1e3)):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/":alert(e.msg)}),!1)})),i(t,s.page[s.type],s.pageName[s.page[s.type]]),$.isFunction($("body").linkSign)&&t.linkSign({live:!0});var a=t.attr("id"),o="re-"+s.page[s.type]+"."+s.tips[s.type];$.force_appear(),t.appear(),t.one("appear",function(){if("undefined"!=typeof _msq&&_msq.push(["trackPanelShow",a,o]),!t.data("log_codes")){for(var e=t.find(".J_xm-recommend-list").find("dt").find("a"),i="",s=0,n=e.length;n>s;s++)i+=e.eq(s).data("log_code")+";";t.attr("data-log_codes",i.substring(0,i.length-1))}})}a(2),a(4);var s={},n=function(t){try{return t.replace(/\s/g,"")}catch(e){return t}};!function(t){function e(t,e,i){if(t.length<5)return!1;var s=a(5),n={v:1,data:t,isBuy:e.isBuy[e.type],itemSite:MI.GLOBAL_CONFIG.itemSite,title:e.title[e.type],page:e.page[e.type]};i.addClass("container").html(s(n)),o(i),null!==e.callback&&"function"==typeof e.callback&&e.callback()}function i(t){return t.length<5?!1:(t.length>20&&(t=t.slice(0,20)),t.length>15&&t.length<20&&(t=t.slice(0,15)),t.length>10&&t.length<15&&(t=t.slice(0,10)),t.length>5&&t.length<10&&(t=t.slice(0,5)),t)}function n(a){var o=s.api[s.type],n={cid:s.gid};t.ajax({url:o,dataType:"jsonp",jsonp:"jsonpcallback",cache:!0,data:n,success:function(o){if(0===o.code){o=o.data||{};var n=t(a);"buyRecommend"===s.type?(e(i(o.alsobuy),s,n),s.type="dirHistoryRecommend",n=t("#J_historyRecommend"),e(i(o.alsoview),s,n)):e(i(o),s,n)}}})}var r={api:{recommendBox:"//rec.www.mi.com/rec/cartbuy",historyRecommend:"//rec.www.mi.com/rec/cartempty",buyRecommend:"//rec.www.mi.com/rec/cartsuccess",dirHistoryRecommend:"//rec.www.mi.com/rec/cartsuccess"},title:{recommendBox:"买购物车中商品的人还买了",historyRecommend:"为您推荐",buyRecommend:"买购物车中商品的人还买了",dirHistoryRecommend:"根据浏览向您推荐"},isBuy:{recommendBox:!0,historyRecommend:!0,buyRecommend:!0,dirHistoryRecommend:!0},page:{recommendBox:"Cart",historyRecommend:"Cart",buyRecommend:"CartSuc",dirHistoryRecommend:"CartSuc"},pageName:{Cart:"购物车",CartSuc:"加购成功"},tips:{recommendBox:"购物车推荐",historyRecommend:"猜你喜欢",dirHistoryRecommend:"看了还看"},useCarousel:{recommendBox:!1,historyRecommend:!1,dirHistoryRecommend:!1}};t.fn.miRecommend=function(e){s=t.extend(r,e),n(this)}}(jQuery)},function(t,e){!function(t){function e(){s=!1;for(var e=0,o=i.length;o>e;e++){var n=t(i[e]).filter(function(){return t(this).is(":appeared")});if(n.trigger("appear",[n]),a){var r=a.not(n);r.trigger("disappear",[r])}a=n}}var a,i=[],o=!1,s=!1,n={interval:250,force_process:!1},r=t(window);t.expr[":"].appeared=function(e){var a=t(e);if(!a.is(":visible"))return!1;var i=r.scrollLeft(),o=r.scrollTop(),s=a.offset(),n=s.left,c=s.top;return c+a.height()>=o&&c-(a.data("appear-top-offset")||0)<=o+r.height()&&n+a.width()>=i&&n-(a.data("appear-left-offset")||0)<=i+r.width()?!0:!1},t.fn.extend({appear:function(a){var r=t.extend({},n,a||{}),c=this.selector||this;if(!o){var d=function(){s||(s=!0,setTimeout(e,r.interval))};t(window).scroll(d).resize(d),o=!0}return r.force_process&&setTimeout(e,r.interval),i.push(c),t(c)}}),t.extend({force_appear:function(){return o?(e(),!0):!1}})}(jQuery)},function(t,e){t.exports=function(t){var e="";t.title&&(e+='<h2 class="xm-recommend-title"><span>'+t.title+"</span></h2>"),e+='<div class="xm-recommend"><ul class="row clearfix">';var a=t.data;if(a)for(var i,o=-1,s=a.length-1;s>o;){i=a[o+=1],e+=' <li class="J_xm-recommend-list span4"> ';var n=i.image.substr(-4,4),r=i.image.substring(0,i.image.length-4);if(e+=" ",i.ext&&i.ext.img&&i.ext.url){e+=" ";var n=i.ext.img.substr(-4,4),r=i.ext.img.substring(0,i.ext.img.length-4);e+=' <a target="_blank" href="'+i.ext.url+'" data-log_code="reccom_'+t.page+"_0_"+o+"#eid="+i.eid+"&traceId="+i.traceid+"&pid="+i.productid+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+o+' data-stat-text="'+i.name+'"> <img src="'+(r+"!234x300"+n)+'" srcset="'+(r+"!468x600"+n)+'  2x" alt="'+i.name+'"> </a> '}else e+=' <dl> <dt> <a href="'+t.itemSite+"/"+i.commodityid+'.html" data-log_code="reccom_'+t.page+"_0_"+o+"#eid="+i.eid+"&traceId="+i.traceid+"&pid="+i.productid+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+o+' data-stat-text="'+i.name+'" target="_blank"> <img src="'+(r+"!140x140"+n)+'" srcset="'+(r+"!280x280"+n)+'  2x" alt="'+i.name+'" /> </a> </dt> <dd class="xm-recommend-name"> <a href="'+t.itemSite+"/"+i.commodityid+'.html" data-log_code="reccom_'+t.page+"_0_"+o+"#eid="+i.eid+"&traceId="+i.traceid+"&pid="+i.productid+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+o+' target="_blank"> '+i.name+' </a> </dd> <dd class="xm-recommend-price">'+i.price+'元</dd> <dd class="xm-recommend-tips"> ',i.comments&&(e+=" ",parseInt(i.comments)>0&&(e+=" "+i.comments+"人好评 "),e+=" "),e+=" ",t.isBuy&&(e+=' <a href="'+t.itemSite+"/cart/add/"+i.goodsid+'-0-1" data-log_code="reccom_'+t.page+"_0_"+o+"#eid="+i.eid+"&traceId="+i.traceid+"&pid="+i.productid+'" data-stat-gid="'+i.goodsid+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+o+' data-stat-text="'+i.name+'" data-stat-addcart="加购" class="btn btn-small btn-line-primary J_xm-recommend-btn">加入购物车</a> '),e+=' </dd> <dd class="xm-recommend-notice"></dd> </dl> ';e+=" </li>"}return e+="</ul></div>"}}]);